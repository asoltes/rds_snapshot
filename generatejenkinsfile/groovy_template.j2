{%- if aws_account_number =="528915018472" -%}
    {% set aws_authentication = "labs-wic-epic-lower-aws-account-num" %}
{%- elif aws_account_number =="731852734120" -%}
    {% set aws_authentication = "epicmirror-lower-aws-account-num" %}
{%- elif aws_account_number == "885239713196" -%}
    {% set aws_authentication = "aws-credentials" %}
{%- endif -%}

pipeline {
  agent any
  parameters {
    choice(
      name: 'RDS_REGION',
      choices: ['us-east-1', 'us-east-2', 'ap-southeast-1', 'ap-southeast-2'],
      description: 'Select the Region of RDS.'
    )

    extendedChoice(
      name: 'RDS_INSTANCE',
      description: 'Check the Instance you need to snapshot',
      multiSelectDelimiter: ',',
      type: 'PT_CHECKBOX',
      groovyScript: """
        return {{ instance_names }}
      """
    )
  }

  environment {
    ASSUME_IAM_ROLE_NAME  = "rds-snapshot-iam-role"
  }

  stages {
    stage('RDS Snapshot') {
      steps {
        script {
          withAWS(credentials: '{{ aws_authentication }}' ) {
            sh "echo rds database snapshot in progress please wait..."
            sh "python3 rds_snapshot.py --db_instances $RDS_INSTANCE --region $RDS_REGION"
          }
 
        }
      }
    }

    // Add more stages as needed
  }
}